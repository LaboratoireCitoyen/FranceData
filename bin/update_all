#!/bin/bash
set -x

export DJANGO_SETTINGS_MODULE=apiserver.settings


DATADIR=${1:-$(dirname $(dirname $0))/data}

echo "Update started at $(date) in $DATADIR"

[ -f $DATADIR/parlementaires.json ] && rm $DATADIR/parlementaires.json
scrapy crawl parlspider -o $DATADIR/parlementaires.json
cat $DATADIR/parlementaires.json | francedata_import_representatives

[ -f $DATADIR/dossiers.json ] && rm $DATADIR/dossiers.json
scrapy crawl dossierspider -o $DATADIR/dossiers.json
cat $DATADIR/dossiers.json | francedata_import_dossiers

[ -f $DATADIR/scrutins.json ] && rm $DATADIR/scrutins.json
scrapy crawl scrutinspider -o $DATADIR/scrutins.json
cat $DATADIR/scrutins.json | francedata_import_scrutins

[ -f $DATADIR/votes.json ] && rm $DATADIR/votes.json
scrapy crawl votespider -o $DATADIR/votes.json -a DATADIR=$DATADIR
cat $DATADIR/votes.json | francedata_import_votes

echo "Update finished at $(date)"
